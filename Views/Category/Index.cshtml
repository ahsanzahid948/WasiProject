
@{
    ViewBag.Title = "Index";
}

<div class="page-header page-header-light">

    <div class="breadcrumb-line breadcrumb-line-light header-elements-md-inline">
        <div class="d-flex">
            <div class="breadcrumb">
                <a href="~/Dashboard/Index" class="breadcrumb-item"><i class="icon-home2 mr-2"></i> Dashboard</a>
                <span class="breadcrumb-item active">Category</span>
            </div>

            <a href="#" class="header-elements-toggle text-default d-md-none"><i class="icon-more"></i></a>
        </div>
    </div>

</div>
<div class="card">
    <div class="card-header header-elements-inline search-header" style="color:white">
        <h5 class="card-title">
            <a class='btn   btn-labeled btn-labeled-left btn-sm authorizeOrNotInsert' href="#" onclick="NewRecord();" data-toggle='modal' data-target='#SaveModal' style="text-decoration:none;background-color:white;">
                <b><i class="icon-plus3"></i></b>
                Add New
            </a>
            <span class="font-weight-semibold">Category</span>
        </h5>
    </div>
    <div class="card-body">
        <table class="table datatable-button-html5-columns dataTable no-footer" id="dtCategory">
            <thead>
                <tr>
                    <th>Sr.</th>
                    <th>Category</th>
                   

                    <th style="text-align:right">Action</th>
                </tr>
            </thead>
            <tbody>
            </tbody>

        </table>

    </div>


</div>

<div id="SaveModal" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">

            <form id="CategoryForm">
                @Html.AntiForgeryToken()
                <div class="modal-header">
                    <h4 class="modal-title"><i class="icon-pencil"></i> <span id="modalHeading" class="caption-subject font-green bold uppercase">Category</span></h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>

                </div>
                <div class="modal-body">
                    <div class="form-body">





                        


                        <div class="form-group row">
                            <label class="control-label col-md-4">
                                Category ID
                                <span class="text-danger"> * </span>
                            </label>
                            <div class="col-md-7">
                                <input type="text" value="" id="txtCategoryNo" name="txtItemNo" maxlength="20" class="form-control" required onkeyup="ClearMessage()" onchange="CheckAvailability();" />
                                <span id="message"></span>
                                <input type="hidden" id="IsValidID" value="true">
                                <input type="hidden" id="txtEdit" value="0">
                               
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="control-label col-md-4">
                                Description
                                <span class="text-danger"> * </span>
                            </label>
                            <div class="col-md-7">
                                <input id="txtDescription" type="text" class="form-control" name="Description" maxlength="50" required />
                            </div>
                        </div>
                        <
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn bg-danger btn-labeled btn-labeled-left btn-sm" style="color:white" data-dismiss="modal"><b><i class="icon-cross2"></i></b>Close</button>
                    <button type="submit" id="btnsave" class="btn btn-primary btn-sm">Save<b><i class="icon-paperplane ml-2"></i></b></button>

                </div>

            </form>

        </div>

    </div>

</div>

@section scripts{
    @Scripts.Render("~/bundles/DataTableScripts")

    <script>
        $(document).ready(function () {
          
            LoadTableData();
        });
       
        function LoadTableData() {
            debugger;
            $("body").tooltip({ selector: '[data-toggle=tooltip]' });
            $('[data-toggle="tooltip"]').tooltip({ html: true });
            //let ID = $("#txtID").val();

            var table = $("#dtCategory").DataTable();
            //var table = $("#dtCategory").DataTable();
            var count = 1;
            var headers = {};
            var token = $('input[name="__RequestVerificationToken"]').val();
            headers['__RequestVerificationToken'] = token;
            $.ajax({
                type: "POST",
                headers: headers,
                contentType: "application/json; charset=utf-8",
                url: "/Category/GetTableSummary",
                data: JSON.stringify({ "ID": "" }),
                dataType: "json",
                success: function (result) {

                    if (result != null && result != "Error") {
                        table.clear();
                        $.each(result, function (i, Data) {
                            
                            var newRow = "<tr><td hidden>" + Data.Cat_ID + "</td>" +
                                "<td  style='text-align:left'>" + count++ + "</td>" +
                                "<td>" + Data.Description + "</td>" +
                               

                                "<td style='text-align:Right'>" +
                                "<div class='list-icons'><div class='dropdown hide'><a href='#' class='btn  actionbtn btn-sm' data-toggle='dropdown' aria-expanded='true'>" +
                                "<i class='icon-menu9'></i></a>" +
                                "<div class='dropdown-menu dropdown-menu-right hide' x-placement='top-end' style='text-align:center;position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(-158px, -127px, 0px);min-width: 6.50rem;padding:0.2rem 0!important;'>" +
                                "<span class='red-tooltip' data-toggle='tooltip' title='Edit'><button onclick='ModifyRecord(\"" + Data.Cat_ID + "\");'type='button' class='btn bg-primary  btn-sm authorizeOrNotUpdate'  style='color:white'><b><i class='icon-pencil'></i></b></button></span>" +
                                "<span class='red-tooltip' data-toggle='tooltip' title='Delete'><button onclick='DeleteRecord(\"" + Data.Cat_ID + "\");'type='button' class='btn bg-danger btn-sm authorizeOrNotDelete'  style='color:white'><b><i class='icon-bin'></i></b></button></span>" +
                                "</div></div></div></td>"

                                /*"<td style='text-align:Right'>" +
                                " <div class='list-icons'><div class='dropdown hide'><a href='#' class='btn  bg-orange btn-sm' data-toggle='dropdown' aria-expanded='true'>" +
                                "<i class='fas fa-th'></i></a>" +
                                "<div class='dropdown-menu dropdown-menu-right hide' x-placement='top-end' style='text-align:center;position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(-158px, -127px, 0px);min-width: 6.50rem;padding:0.2rem 0!important;'>" +
                                "<span class='red-tooltip' data-toggle='tooltip' title='Edit'><button onclick='ModifyRecord(" + Data.Dept_ID + ");'type='button' class='btn   btn-sm authorizeOrNotUpdate'  style='color:white;background-color:Blue;'><b><i class='fas fa-edit'></i></b></button></span>" +
                                "<span class='red-tooltip' data-toggle='tooltip' title='Delete'><button onclick='DeleteRecord(" + Data.Dept_ID + ");'type='button' class='btn bg-danger btn-sm authorizeOrNotDelete'  style='color:white'><b><i class='fas fa-trash'></i></b></button></span>" +
                                "</div ></div ></div></td>"*/
                            "</tr > ";

                            table.row.add($(newRow));
                        });
                        table.draw();
                    }
                    else {
                        var errorMessage = ' (Error Code: "400")';
                        swal("", errorMessage, "error");
                    }
                },
                error: function (xhr, status, error) {
                    var errorMessage = ' (Error Code: ' + xhr.status + ')';
                    swal("", errorMessage, "error");

                }


            });
        }

        function ModifyRecord(ID) {
            debugger;

            $('#modalHeading').text(" Modify Category");

            $('#txtCategoryNo').val(ID);
            LoadModifyData(ID);
            $('#SaveModal').modal('show');
            $('#btnsave').show();
            $('#btnsave').text('Update');


        }
        function LoadModifyData(ID) {
            if (ID > 0 && ID <= 9) { ID="0"+ID}
            debugger;
            var headers = {};
            var token = $('input[name="__RequestVerificationToken"]').val();
            headers['__RequestVerificationToken'] = token;
            $.ajax({
                type: "POST",
                headers: headers,
                contentType: "application/json; charset=utf-8",
                url: "/Category/GetTableSummary",
                data: JSON.stringify({ ID: ID }),
                dataType: "json",
                success: function (result) {
                    if (result != null && result != "Error") {
                        debugger;
                        $.each(result, function (i, Data) {
                            //$('#txtCategoryNo').val("");
                            $('#txtCategoryNo').val(Data.Cat_ID);
                           
                            $('#txtDescription').val(Data.Description);
                            $('#txtCategoryNo').prop("disabled", true);
                            
                        });
                    }
                    else {
                        //var errorMessage = AjaxErrorMessage + ' (Error Code: "400")';
                        var errorMessage = ' (Error Code: "400")';
                        swal("", errorMessage, "error");
                    }
                },
                error: function (xhr, status, error) {

                    //var errorMessage = AjaxErrorMessage + ' (Error Code: ' + xhr.status + ')';
                    var errorMessage = '(Error Code: ' + xhr.status + ')';
                    swal("", errorMessage, "error");

                }

            });
        }
      
        function NewRecord() {
            debugger;
            $('#modalHeading').text(" Add Category");

            $('#SaveModal').modal('show');
           
            $('#txtDescription').val('');
            $('#txtCategoryNo').prop("disabled", false);
           
            $('#txtCategoryNo').val('');
            $('#btnsave').show();
            $('#btnsave').text('Save');

        }
        $("#CategoryForm").submit(function (event) {
            debugger;
            event.preventDefault();
            SaveRecord();
        });
        function SaveRecord() {
            try {
                debugger;

                if ($('#IsValidID').val() != "true" && $('#IsValidID').val() != true) {

                    swal("Warning", "Category Number already exists!", "error");
                }
                else {


                    if ($('#btnsave').text() == 'Save') {
                        var Title = "";
                        var Text = "Are you sure you want to Save this record ?";
                        var ConfirmButtonText = "Confirm Save";
                        var CancelButtonText = "Cancel";
                    }
                    if ($('#btnsave').text() == 'Update') {
                        var Title = "";
                        var Text = "Are you sure you want to Update this record ?";
                        var ConfirmButtonText = "Confirm Update";
                        var CancelButtonText = "Cancel";
                    }
                    swal(
                        {
                            title: Title,
                            text: Text,
                            type: "warning",
                            showCancelButton: true,
                            confirmButtonText: ConfirmButtonText,
                            cancelButtonText: CancelButtonText,
                            closeOnConfirm: false,
                            closeOnCancel: true
                        },
                        function (isConfirm) {
                            debugger;
                            if (isConfirm) {
                                var AjaxObj = AjaxObjCall();//InventoryObjCall();

                                var headers = {};
                                var token = $('input[name="__RequestVerificationToken"]').val();
                                headers['__RequestVerificationToken'] = token;
                                var Url = "";
                                if ($('#btnsave').text() == 'Save') {
                                    Url = "/Category/Create";
                                }
                                else {
                                    Url = "/Category/Update";
                                }

                                $.ajax({
                                    type: "POST",
                                    headers: headers,
                                    contentType: "application/json; charset=utf-8",
                                    url: Url,
                                    data: JSON.stringify(AjaxObj),
                                    //data: JSON.stringify({ "Obj": AjaxObj }),
                                    dataType: "json",
                                    async: false,
                                    success: function (result) {
                                        debugger;
                                        if (result.Code == 200) {
                                            debugger;
                                            $('#SaveModal').modal('hide');
                                            LoadTableData();
                                            swal("", result.Message, result.Type);
                                            //SaveInventoryImages($("#txtCategoryNo").val());
                                        }
                                        else {
                                            swal("", result.Message, result.Type);

                                        }

                                    },
                                    error: function (xhr, status, error) {
                                        var errorMessage = AjaxErrorMessage + ' (Error Code: ' + xhr.status + ')';
                                        swal("", errorMessage, "error");
                                    }

                                });


                            }
                            else {

                                swal("Cancelled", "Your operation Canceled :)", "error");
                            }

                        }
                    );
                }
            }
            catch (err) {
                swal("Cancelled", err.ToString(), "error");
            }
        }

        function AjaxObjCall() {
            debugger;
            var AjaxObj = { "Cat_ID": "", "Description": ""};//, SubType
            AjaxObj.Cat_ID = $("#txtCategoryNo").val();
            AjaxObj.Description = $("#txtDescription").val();
          


            return AjaxObj;
        }
        function DeleteRecord(ID) {
            debugger;
            if (ID > 0 && ID <= 9) { ID = "0" + ID }
            swal({
                title: "",
                text: "Are you sure you want to Delete this record?",
                type: "warning",
                showCancelButton: true,
                confirmButtonText: "Confirm Delete",
                cancelButtonText: "Cancel",
                closeOnConfirm: false,
                closeOnCancel: true
            },
                function (isConfirm) {
                    if (isConfirm) {
                        var headers = {};
                        var token = $('input[name="__RequestVerificationToken"]').val();
                        headers['__RequestVerificationToken'] = token;
                        $.ajax({
                            type: "POST",
                            headers: headers,
                            contentType: "application/json; charset=utf-8",
                            url: "/Category/Delete",
                            data: JSON.stringify({ ID: ID }),
                            dataType: "json",
                            success: function (result) {
                                debugger;
                                if (result.Code == 200) {
                                    LoadTableData();
                                    swal("", result.Message, result.Type);
                                }
                                else {
                                    swal("", result.Message, result.Type);

                                }

                            },
                            error: function (xhr, status, error) {
                                var errorMessage = AjaxErrorMessage + ' (Error Code: ' + xhr.status + ')';
                                swal("", errorMessage, "error");
                            }

                        });


                    } else {

                        swal("Cancelled", "Your operation Canceled :)", "error");
                    }
                });

        }


        function ClearMessage() {
            $("#message").html("");
        };
        function CheckAvailability() {

            debugger;
            var ItemNo = $("#txtCategoryNo").val();
            var IsEdit = $('#txtEdit').val();
            var headers = {};
            var token = $('input[name="__RequestVerificationToken"]').val();
            headers['__RequestVerificationToken'] = token;
            $.ajax({
                type: "POST",
                url: '/Category/CheckCatNo',
                headers: headers,
                data: JSON.stringify({ CatNo: ItemNo, IsEdit: IsEdit }),

                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (result) {
                    var message = $("#message");
                    if (result == true) {


                        $("#IsValidID").val(result);
                    }
                    else if (result == false) {
                        message.css("color", "red");
                        message.html("Category No. already exists!");
                        $("#IsValidID").val(result);
                    }
                    else {
                        var errorMessage = AjaxErrorMessage + ' (Error Code: "400")';
                        swal("", errorMessage, "error");

                    }

                },
                error: function (xhr, status, error) {
                    var errorMessage = AjaxErrorMessage + ' (Error Code: ' + xhr.status + ')';
                    swal("", errorMessage, "error");
                }




            });

        }

       
    </script>
}

